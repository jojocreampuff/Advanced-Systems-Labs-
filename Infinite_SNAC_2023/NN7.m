function [Y,Xf,Af] = NN7(X,~,~)
%NN7 neural network simulation function.
%
% Auto-generated by MATLAB, 21-Mar-2023 11:18:52.
% 
% [Y] = NN7(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 3xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 3xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-9.48097647696407;-9.53967075422367;0.000108759662108788];
x1_step1.gain = [0.105458851622077;0.104665186551879;0.100043395477172];
x1_step1.ymin = -1;

% Layer 1
b1 = [-5.2499497636178560356;0.2817257904369203092;-2.6187227087609907805;-9.5816223594291081156;0.078773824860898705724;-1.4283218356980562636;-1.0603614700527022041;2.5945664290689083309;0.010801014833825853256;-1.2434458533035452898;4.9922617521942491692;0.47275330276501387194;1.6565747118768741064;1.5657136062175402991;3.4405861997827886789];
IW1_1 = [1.0875363864239597778 2.4579567922787877166 -4.7794290380965165355;-1.6557258785328348161 0.092457451627661293991 -0.62040749661384364533;0.10895551753636925629 -1.5025466637822837423 -2.2766579807258651158;0.63414890888952246684 -4.2680984758359254982 -8.8599359363061402917;-0.1366065988736385739 0.60189093046702679679 0.050647781467335742378;0.47678312090466629103 0.52183891568674423134 -1.2680645880007708204;0.91174032287578476996 -0.041404162528950343158 0.19312552539815239228;-0.32906650225700595502 -2.0362316464083072276 1.856405894141098134;-0.14983630524796842654 0.65047149798199399573 0.1710084545100937492;-2.24632249778558446 0.063282095525932488544 -1.2832870647490217664;5.605487880605316775 -0.35941348943385986736 4.2169890480553267054;0.40587578832674431339 0.59176930370577485174 -0.7151906465789131806;0.4816493238181650538 0.69840543564161183809 -0.6250492816115831296;0.25756303549145243004 -0.65705005087752710313 -0.50245096302686953482;2.2413293725291674185 -0.11925313188809087694 0.80997578401564573891];

% Layer 2
b2 = [0.097935282468522219523;0.40688408854562391204;0.70436427179308591651;-0.48549463752790655846;0.30073919311689223388;-0.015984397490356617305;-1.9491847818960814642;-1.4794804736433029291;0.67881611129738828048;-2.2372338187980047586];
LW2_1 = [-1.8854158998995540486 0.078369031310743950125 1.6642729297951373013 3.9222353734315089646 0.50529137902450993458 -1.0020286554572603865 -0.48278141618967973514 0.58426835066178472999 -1.9067318774809196569 0.035413005435702381296 -0.15305480518966821379 0.11826840566588459058 0.69964637268590990082 0.26372931198902965777 -0.49511669959056664458;-0.35393604144830870251 -1.565282657784424325 -1.2928269112649053429 -2.8870038430372337857 -1.2991189129275355629 -0.66326752765522034583 0.78651102486846502515 -0.059675850340279397443 0.68701811210428076482 -0.42409845829244846582 0.38832716757081248149 0.17281571218699592896 0.21245290865306820649 -0.31681270075586509538 -0.96533330535705674791;0.59563724307039989103 0.027420395715210203746 -0.56206429325224283033 3.8328026234409025008 -0.337862174443853025 0.78632033664007361384 -0.10706268583540438921 0.64243855494398816042 1.2543164169403284713 0.044876680427433750242 -0.052342666335499291042 0.12088363586184903975 -0.169078194579003388 0.072882507621702619094 1.1649643744289568392;-0.027449869919748126623 -1.3386040191955816958 -1.2035263524159505177 -2.6786649354729283878 0.76028139048530463118 -0.71883135430842026725 1.2109465314923293366 0.9610846218398197971 1.2454516076421531245 -0.89359169807989091705 0.45943998448434530957 -1.9796861379726204966 0.12944400982216749951 0.94617372751232398098 0.41508314544775209987;-0.52602436643685623885 -0.91104340639150904746 -0.93870784442041532714 -1.2048622939296704804 0.39191375828263852465 -2.2910416171841196942 -0.28076412944356415879 -0.79933760734552061766 0.72470065393872651338 1.6103556296322405483 -0.76550081494499888635 -0.25618647418775930547 0.47406778682602523922 0.55930477138449141705 0.26740776778067854025;2.5979635366954276776 -0.50044973562037053938 0.38135697494844372768 2.3807038261100217369 0.13805298650981526198 1.981982160471333243 0.29317985340970309505 0.39189003170312691759 0.050601436210890492207 -1.4345918753284505609 4.1322545991756625128 0.32616278511501489712 -0.22276871990934676848 0.5840443814214203444 0.34434560796461849419;0.0076672345694222664853 -0.0028082150906704535405 -0.008106453880082725022 0.044426544867934812666 0.80138646750141950825 0.047684088392463283568 -0.092955828940615992106 0.077949947078640377529 -0.7412863488928979061 -0.023452252021463823595 0.032489865906163185871 0.061994979255483535774 0.15336715477398157881 0.31432868016993453786 0.39554033582768965971;-0.50560458865046298271 -0.082300170798982691389 1.3236693839101503212 3.2940718387223553165 -0.51487800146530537937 0.25711804466198540098 -0.30541607802922932091 0.65550030922165003489 -0.84089582394083872696 -0.53693206419048777889 1.7490798106579099613 0.44430774271869621916 0.5283153383786786117 -0.50305023604412779648 0.74006836955031296554;0.24852961259353159584 0.10477931449942189113 0.16696609987233376748 0.67832816602380718862 1.0101297322567492909 0.012546337997388256474 -0.61555055600062036358 -0.013989560783006138936 -1.0833025203907347134 0.018097202877354303524 -0.038706584088308119973 0.2558387914370747751 0.59931496286133212337 0.822409454808002649 0.38391520460917860635;0.20807742371648602075 -0.29674230445145960422 0.19406916428919135376 0.44993219953336138772 0.84304381649317405856 0.96833522985517139769 -0.087868838669729207314 0.80927485609183180681 -1.2466747913191711383 -1.1937277970567570229 -0.012206328294057884609 0.64009739210615701488 0.55716816531557378234 -0.44016879558712790343 -0.97420260965437466272];

% Layer 3
b3 = [1.4819895044794497707;-0.40488604541791023417;0.79957827280697324479;-1.3157355942890947009;0.74559987843026664933;-0.45237878714583640294;0.15736098842837051293;0.79115783427268782102];
LW3_2 = [-1.4306174938415674447 0.6234660086898320408 0.12774601255443149284 0.098438769885225749223 -0.079555292760212781289 -0.92870248967735702372 1.0412606046127519388 -0.1152693428243702356 -0.26138194676031045738 0.87254980297805484479;3.1154560035983185351 -0.67958546572094435945 4.3331435756228913192 0.22670713738276149218 0.91373220587195713716 -2.5974898490565703213 -0.41532166435780093483 0.07193547773252483013 1.4587859287307467504 -0.088394471679972594358;-0.21347063509378905177 0.75103771061515356422 -0.79737521927390242471 0.84528302947200428807 0.70863583613233094294 -0.61753870251063502916 -0.31071542479498953648 0.1039749596618769617 0.33187672178841676196 -0.15558109921637011674;-0.065127559400999346373 -1.5952560787061353942 -0.49430534878709342372 1.2103705885366073947 0.20922372213398118812 0.0038666473791870905469 2.0454079122801345214 0.1470771023058670135 0.92577648765760989225 -0.8638664275561852568;2.8376215999129228429 -0.30249171416524744949 1.735480818836599326 -0.46764998223489812057 -0.34147069191018231127 2.3902624229088282881 1.5212300832776719517 2.9045487620071370749 1.5305875683688441313 -1.3194592141695469234;-1.621529005198191653 -1.1634094313422540523 2.9034445135093047696 0.99364847127611699573 0.67874532048482372204 -0.022545667847163549519 0.23141400157462710396 -0.91172621444703916271 -0.59280663547541589953 -0.55918290735588982443;-0.61978567223245994988 0.46199404941089605714 0.013993090790628917933 -0.062684320970494381009 0.35155424327663770123 0.070338902383219631398 0.50316335220845009868 2.0265464278051563696 -0.062698586532436303975 -1.3139973914566533963;3.0272596924540700059 2.0911347871760916917 -3.9242957888090246321 4.6415498940900192792 -1.089928604395031364 -0.84154414318256010041 0.23861026657113920679 0.43534766470353236656 -0.72055581637939025708 0.088951798329995876435];

% Layer 4
b4 = [-1.0969476654370251545;2.2888622948562269421;0.70779472595704906457;0.24723152164955797261;1.6906092984782146171];
LW4_3 = [0.78036205618548537544 0.38736905384683223419 0.69644487718486103311 0.12692513682088468752 -4.440466492269270482 1.5815252628993754502 -1.2909626470015604927 -3.6686646514589522639;1.4269039449063405378 1.7479467775088659565 0.63918380609399583214 -2.8836131966050806419 2.50894259512296669 1.7023582996595369998 -1.1505701248903081879 -1.5549524524947504478;-0.017730135669198066051 -0.0058451775845858528272 0.86105484459038450495 2.5047121578232931505 -0.019018716998461721035 0.040493837815951443104 -0.098444718021787197548 -0.04022712737653115489;-0.16759964035590396714 5.2606649575059867274 1.5539899276220610069 0.84323402066750896555 -1.9812817234003066158 -1.6973433713473580209 -2.022931310189543197 2.8365844301884148848;0.21299027918897248113 0.90506465354564347159 0.755314184028409219 -0.19414849686742471913 -0.67255304096690027293 0.28618507237440937718 -0.3966873511684084197 0.87938688472600412549];

% Layer 5
b5 = [-1.0681588956110910082;-0.70546455307156286096;0.088404345933510236621];
LW5_4 = [0.059905007938180841742 0.0037002439991569431414 -4.1885249575850034276 -0.012356237904530097474 0.1113702057338634005;-4.9398017927707504882 3.0956159047559879127 -0.4206116087587596919 3.2565515928768653531 -2.4247717131761934439;-3.6612333971922441656 -0.78812503215350759866 -1.1240072059992181064 -4.9561456251319349064 0.572471820126369213];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = [0.100002056732639;2.00002564538846;2.00005774983066];
y1_step1.xoffset = [0.000132461484070312;-0.499993843068977;-0.499986755561615];

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = tansig_apply(repmat(b3,1,Q) + LW3_2*a2);
    
    % Layer 4
    a4 = tansig_apply(repmat(b4,1,Q) + LW4_3*a3);
    
    % Layer 5
    a5 = repmat(b5,1,Q) + LW5_4*a4;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a5,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(5,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
